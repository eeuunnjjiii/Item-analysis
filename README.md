# Project | Product analysis by category

## 1. 프로젝트 개요
제목 : 카테고리별 상품 분석과 등급 분류

모바일 데이터 분석 플랫폼 기업의 데이터를 이용한 기업 협업 팀 프로젝트로 상품 기반 분석을 담당하여 진행하였다. 카테고리별 구매가능성 등급 분류에서는 기업측이 제안한 RFM 분석기법을 이용한 분류 방법과 여러가지 모델링 결과를 비교했다.

[ 담당 주제 ]
- 카테고리별 구매가능성 등급 분류 및 예측
- 카테고리별 긍정/부정 상품 분석
- 상품별 연관상품 분석

## 2. 프로젝트 진행 방법
### 1) 데이터 수집
- 기업 측에서 제공한 데이터 사용 (2020년 11월-2021년 2월 데이터)
- 상품별 연관상품 분석 데이터 : 세션키, 주문번호, 이벤트 종류 등으로 구성
- 카테고리별 구매가능성 등급 분류 : 카테고리명, 상품명, 마지막 구매일, 장바구니 담기일, 총 구매액 등으로 구성
- 카테고리별 긍정/부정 상품 분석 : 카테고리명, 상품명, 구매수, 장바구니 담기 수 등 시계열 데이터

### 2) 데이터 전처리
- 성능 확인을 위해 카테고리별 긍정/부정 상품 분석 시계열 데이터를 이용해 11월-1월 / 2월 데이터로 분리
- 구매일, 장바구니 담기일 등 날짜 결측치는 11월 이전 구매 발생으로 간주하여 최대일수 120일 부여
- 중복값 확인 결과 상품번호 기준 중복값이 있었으나 카테고리가 다르므로 다른 상품으로 취급
- 주문 상품 대상 주문번호별 상품과 장바구니 상품 대상 세션키별 상품을 묶어 데이터 재구성

### 3) 분석 및 시각화
- 구매일, 장바구니 담기일 기준 분석 (경과일, 월별, 요일별)
- 변수간 상관관계 확인 (총 판매액과 상관관계가 높은 특성 : 일평균 장바구니 담기수, 구매수, 일평균 구매수)
- 전체 데이터 13만건 중 70%가 총 판매액이 0인 불균형한 데이터임을 확인

### 4) 모델링과 결과
**[카테고리별 구매가능성 등급 분류 및 예측]**
- RFM 등급 분류 : 구매경과일(R), 구매수(F), 총 판매액(M) 변수로 구매가 일어나지 않은 데이터(구매경과일 120일, 구매수 0, 총 판매액 0)는 모두 1점, 나머지를 균등분배하여 점수 부여. RFM 가중치는 동일비 부여와 등급별 매출 기여도 분산이 가장 큰 가중치 부여로 비교 진행
- K-Means Clustering 분류: RFM 변수, RFM 점수, 전체 데이터, 비구매 데이터 제외 데이터로 구분해 K-Means Clustering 진행
- 이진분류 모델 : 11월-12월 / 1월 데이터로 분리하여 1월 데이터의 구매 여부를 타겟값으로 이진분류하는 모델 구축 > 예측 확률을 5개 등급 분류 (XGBoost 모델 사용, ROC-AUC score 0.95)
- 금액예측 모델 : 11월-12월 / 1월 데이터로 분리하여 1월 데이터의 총 구매액을 타겟값으로 예측하는 모델 구축 > 예측구매액을 5개 등급으로 분류 (Linear Regression 모델 사용, R squre 0.95)

- 성능 평가 : 11월-1월 데이터 중 구매 확률이 가장 높은 1등급과 가장 낮은 5등급의 2월 구매 발생 여부에 따라 분류성능 평가지표 비교
<img width="717" alt="스크린샷 2021-09-18 오전 7 41 15" src="https://user-images.githubusercontent.com/75970111/133860861-09a81c71-f04e-46b2-a592-bc566340e909.png">

이미 한번 분류를 진행한 RFM 점수를 활용한 K-Means Clustering을 제외하고는 1등급 개수 자체가 너무 적어 TP가 현저히 낮아 precision이나 F1 score가 낮았다. 따라서 모든 지표에서 골고루 높은 성능을 보이는 RFM 점수를 활용한 K-Means Clustering 모델을 최종 선택했다. (Precision:0.6, Recall:0.59, Accuracy:0.92, F1 score:0.6)

**[카테고리별 긍정/부정 상품 분석]**
- 이동평균선(7일, 14일, 30일) 컬럼 추가로 급상승 상품, 급하락 상품, 베스트 상품, 워스트 상품 추출

기준일을 지정해 특정일로부터 급상승/급하락 상품 등을 보다 빠르게 확인할 수 있다. 또한 이동평균선 컬럼을 이용해 상품 등급 분류도 시도했지만 정확도가 68%에 그쳤다.

**[상품별 연관상품 분석]**
- mlxtend 라이브러리의 apriori 알고리즘 사용
- 지지도/신뢰도/향상도 계산하는 함수 구축

전체 데이터를 이용해 apriori 알고리즘을 사용했으나 코랩 램 용량 초과 문제로 인해 5만여개의 구매 데이터만 적용할 수 있었고, 지지도 0.001 기준으로 신뢰도와 향상도를 확인할 수 있었다. 전체 데이터의 연관상품 분석을 위해 지지도/신뢰도/향상도를 직접 계산하는 함수를 이용해 연관분석 결과를 확인했다.

## 4. 프로젝트 개선사항
- 시간부족으로 모델 하이퍼파라미터 조절을 진행하지 못함
- 상품 조회수, 찜하기 등 다양한 변수가 있었다면 더욱 유의미한 인사이트 발견과 좋은 성능의 모델 구축 기대
